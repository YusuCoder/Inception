[mysqld]
port=MYSQL_PORT
bind-address=MYSQL_ADDRESS








# set -e

# mkdir -p /run/mysqld
# chown -R mysql:mysql /run/mysqld
# DATADIR='/var/lib/mysql'
# SOCKET='/run/mysqld/mysqld.sock'
# DATABASE_ALREADY_EXISTS='false'

# check_env() {
#     i=0
#     while read var; do
#         content=$(eval "echo \${$var}")
#         if [ -z "$content" ]; then
#             echo "‚ùå You need to specify $var"
#             i=$((i+1))
#         fi
#     done << EOF
# MARIADB_ROOT_PASSWORD
# MARIADB_USER
# MARIADB_PASSWORD
# MARIADB_DATABASE
# EOF

#     if [ $i -gt 0 ]; then
#         exit 1
#     fi
# }

# prepare_files() {
#     echo "[client-server]
# socket=$SOCKET
# port=3306
# [mysqld]
# datadir=$DATADIR
# skip-networking
# " > /etc/my.cnf

#     mkdir -p "$DATADIR" /run/mysqld
#     chown -R mysql:mysql "$DATADIR" /run/mysqld
# }

# init_database() {
#     echo "Initializing MariaDB database..."
#     mysql_install_db --user=mysql --datadir="$DATADIR" --rpm > /dev/null
#     echo "‚úÖ Database initialized."
# }

# start_temp_server() {
#     echo "‚è≥ Starting temporary MariaDB server..."
#     mysqld --skip-networking --socket="$SOCKET" &
#     MARIADB_PID=$!

#     for i in {30..0}; do
#         if mariadb --socket="$SOCKET" -uroot --password="" -e "SELECT 1" > /dev/null 2>&1; then
#             echo "‚úÖ Temporary MariaDB server started."
#             return
#         fi
#         echo "‚è≥ Waiting for MariaDB to start..."
#         sleep 1
#     done

#     echo "‚ùå MariaDB failed to start."
#     exit 1
# }

# stop_temp_server() {
#     echo "üõë Stopping temporary MariaDB server..."
#     kill "$MARIADB_PID"
#     wait "$MARIADB_PID"
#     echo "‚úÖ Temporary MariaDB server stopped."
# }

# sql_escape() {
#     printf "%s" "$1" | sed "s/'/''/g"
# }

# setup_db() {
#     echo "üõ† Creating database $MARIADB_DATABASE and user $MARIADB_USER..."

#     rootPassEsc=$(sql_escape "$MARIADB_ROOT_PASSWORD")
#     userPassEsc=$(sql_escape "$MARIADB_PASSWORD")

#     mariadb --socket="$SOCKET" -uroot <<-EOSQL
#         DELETE FROM mysql.user WHERE user NOT IN ('mysql.session', 'mysql.sys');
#         CREATE USER 'root'@'localhost' IDENTIFIED BY '$rootPassEsc';
#         GRANT ALL ON *.* TO 'root'@'localhost' WITH GRANT OPTION;

#         DROP DATABASE IF EXISTS test;
#         CREATE DATABASE IF NOT EXISTS \`$MARIADB_DATABASE\`;
#         CREATE USER '$MARIADB_USER'@'%' IDENTIFIED BY '$userPassEsc';
#         GRANT ALL PRIVILEGES ON \`$MARIADB_DATABASE\`.* TO '$MARIADB_USER'@'%';
#         FLUSH PRIVILEGES;
# EOSQL
#     echo "‚úÖ Database setup complete."
# }

# main() {
#     if [ -d "$DATADIR/mysql" ]; then
#         DATABASE_ALREADY_EXISTS='true'
#     fi

#     if [ "$DATABASE_ALREADY_EXISTS" = 'false' ]; then
#         check_env
#         prepare_files
#         init_database
#         start_temp_server
#         setup_db
#         stop_temp_server
#         echo "‚úÖ MariaDB initialized."
#     else
#         prepare_files
#         echo "üîÅ MariaDB already initialized, skipping setup."
#     fi

#     echo "Switching to 'mysql' user..."
#     exec su-exec mysql mysqld
# }

# if [ "$1" = 'mariadb' ]; then
#     main "$@"
# else
#     exec "$@"
# fi
